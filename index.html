<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>R.E.A.D. – Ranau English Analytics Dashboard (Live)</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React / ReactDOM (UMD builds) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- PropTypes (Recharts UMD dependency) -->
  <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>

  <!-- Recharts UMD -->
  <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

  <!-- Babel for JSX in the browser (keeps parity with your current file) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Firebase (Realtime DB) -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js"></script>

  <style>
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f3f4f6; }
    .hide-scrollbar::-webkit-scrollbar { display:none; } .hide-scrollbar { -ms-overflow-style:none; scrollbar-width:none; }
    .animate-fade-in { animation: fadeIn 0.25s ease-in-out; }
    @keyframes fadeIn { from { opacity:0; transform: translateY(6px); } to { opacity:1; transform: translateY(0); } }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
  // ======= GLOBAL HELPERS & LIBS ========
  const { useState, useEffect, useMemo } = React;
  const RechartsObj = window.Recharts || window.Recharts.default || {};
  const { PieChart, Pie, Cell, Tooltip, Legend, ResponsiveContainer, BarChart, Bar, XAxis, YAxis, CartesianGrid, LabelList } = RechartsObj;

  // Grades & points mapping (reused from your original)
  const grades = ['A+','A','A-','B+','B','C+','C','D','E','G','TH'];
  const POINTS = {'A+':0,'A':1,'A-':2,'B+':3,'B':4,'C+':5,'C':6,'D':7,'E':8,'G':9,'TH':9};

  // ========== FIREBASE INIT ===========
  // Use your config (you provided earlier) — kept inline for immediate use.
  const firebaseConfig = {
    apiKey: "AIzaSyDOMGkWG-7-Hmv4m3reUNr-AJA4hUTMPnY",
    authDomain: "read-6034d.firebaseapp.com",
    databaseURL: "https://read-6034d-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "read-6034d",
    storageBucket: "read-6034d.firebasestorage.app",
    messagingSenderId: "282456310870",
    appId: "1:282456310870:web:17d1d0488cf1a9d4bda7f7",
    measurementId: "G-4SD732BSHW"
  };

  // Initialize (UMD firebase global objects)
  if (!window.firebase || !window.firebase.apps) {
    console.warn("Firebase library not found - Realtime sync will not work.");
  }
  try {
    window.firebaseApp = firebase.initializeApp(firebaseConfig);
    window.db = firebase.database();
  } catch (e) {
    console.warn("Firebase init error (may already be initialized):", e.message || e);
    window.db = firebase.database();
  }

  // ======== GOOGLE SHEETS MULTI-SHEET LOADER =========
  // Provided spreadsheet ID (from your edit link)
  const SHEET_ID = "1GUW9dJE5AkaiAMRJhT4AIg6ikFKPNSWfnghgkW-V7oQ";

  // Attempt to fetch CSV for each gid 0..24 and return valid CSVs
  async function tryLoadAllSheets(spreadsheetId, maxGid=24) {
    const base = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/export?format=csv&gid=`;
    const results = [];
    for (let gid = 0; gid <= maxGid; gid++) {
      try {
        const url = base + gid;
        const res = await fetch(url);
        // Google returns 200 even for some invalid requests, check content-type or body heuristics:
        if (!res.ok) continue;
        const text = await res.text();
        if (!text || text.trim().length < 10) continue;
        // Heuristic: if content contains commas and newlines, treat as CSV:
        if (text.indexOf(",") === -1) continue;
        // Save
        results.push({ gid, text });
      } catch (e) {
        // ignore any single-gid fetch errors and continue
      }
    }
    return results; // array of {gid, text}
  }

  // CSV parser (handles quoted fields, CRLF)
  function parseCSV(text) {
    // Simple RFC4180-ish parser (handles quoted fields)
    const rows = [];
    let cur = '';
    let row = [];
    let inQuotes = false;
    for (let i=0;i<text.length;i++) {
      const ch = text[i];
      if (ch === '"' ) {
        // Peek next char for escaped quote
        if (inQuotes && text[i+1] === '"') {
          cur += '"';
          i++;
        } else {
          inQuotes = !inQuotes;
        }
        continue;
      }
      if (!inQuotes && (ch === '\r' || ch === '\n')) {
        if (cur !== '' || row.length > 0) {
          row.push(cur);
          rows.push(row);
          row = [];
          cur = '';
        }
        // skip possible \r\n pair
        if (ch === '\r' && text[i+1] === '\n') i++;
        continue;
      }
      if (!inQuotes && ch === ',') {
        row.push(cur);
        cur = '';
        continue;
      }
      cur += ch;
    }
    // push last
    if (cur !== '' || row.length > 0) {
      row.push(cur);
      rows.push(row);
    }
    // Trim whitespace from each cell
    return rows.map(r => r.map(c => typeof c === 'string' ? c.trim() : c));
  }

  // Normalize header label to a key: "Name" -> "name", "No Kad Pengenalan" -> "nokad"
  function normalizeHeader(h) {
    if (!h) return '';
    return h.toString().toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/^_+|_+$/g,'');
  }

  // Heuristic: decide if a sheet is a candidate list (has name + grade OR mark)
  function sheetLooksLikeCandidate(headersNorm) {
    const hasName = headersNorm.some(h => /name|candidate|student|nama/.test(h));
    const hasGradeOrMark = headersNorm.some(h => /grade|mark|score|marks|markah|gred/.test(h));
    return hasName && hasGradeOrMark;
  }

  // Build students + summary from candidate-like sheet
  function buildFromCandidateSheet(rows, headers) {
    const headerNorm = headers.map(normalizeHeader);
    const idx = (n) => headerNorm.indexOf(n);
    // Identify common header keys by fuzzy match
    const nameIdx = headerIndexLike(headerNorm, ['name','nama','student','candidate']);
    const schoolIdx = headerIndexLike(headerNorm, ['school','sekolah','institution']);
    const classIdx = headerIndexLike(headerNorm, ['class','kelas','form']);
    const markIdx = headerIndexLike(headerNorm, ['mark','marks','score','markah']);
    const gradeIdx = headerIndexLike(headerNorm, ['grade','gred']);

    const students = [];
    for (let i=0;i<rows.length;i++){
      const r = rows[i];
      // skip empty rows
      if (r.every(c=>c===undefined||c==='')) continue;
      const s = {
        id: i+1,
        name: nameIdx>=0 ? (r[nameIdx] || "").toString().trim() : `Row ${i+1}`,
        school: schoolIdx>=0 ? (r[schoolIdx] || "").toString().trim() : 'Unknown',
        className: classIdx>=0 ? (r[classIdx] || "").toString().trim() : 'Unknown',
        mark: markIdx>=0 ? parseInt((r[markIdx]||'').toString().replace(/[^\d-]/g,'')) || 0 : null,
        grade: gradeIdx>=0 ? (r[gradeIdx] || "").toString().trim().toUpperCase() : ''
      };
      students.push(s);
    }

    // Group by school|class
    const grouped = {};
    students.forEach(s => {
      const key = `${s.school}|${s.className}`;
      if(!grouped[key]) {
        grouped[key] = {
          schoolId: (s.school || 'UNKNOWN').replace(/\s+/g,'_').toUpperCase(),
          schoolName: s.school || 'Unknown',
          className: s.className || 'Unknown',
          totalCandidates: 0,
          grades: grades.reduce((a,g) => ({...a,[g]:0}), {})
        };
      }
      grouped[key].totalCandidates++;
      const g = (s.grade || 'TH').toUpperCase();
      // some grades may be numeric - ignore
      grouped[key].grades[g] = (grouped[key].grades[g]||0) + 1;
    });

    const summary = Object.values(grouped).map(g => {
      // compute gp
      let sum = 0, count = 0;
      Object.entries(g.grades).forEach(([gr,qty]) => {
        if (gr !== 'TH') {
          sum += (POINTS[gr] || 9) * qty;
          count += qty;
        }
      });
      g.gp = count ? parseFloat((sum / count).toFixed(2)) : 9.00;
      return g;
    });

    return { students, summary };
  }

  // helper: find index of header by approximate keys
  function headerIndexLike(normHeaders, candidates) {
    candidates = candidates.map(c=>c.toLowerCase());
    for (let i=0;i<normHeaders.length;i++) {
      for (let cand of candidates) {
        if (normHeaders[i].indexOf(cand) !== -1) return i;
      }
    }
    return -1;
  }

  // Load all sheets and build source object
  async function loadAllSheetsAsSource() {
    const sheetTexts = await tryLoadAllSheets(SHEET_ID, 24);
    // If none found, fall back to published single CSV link (provided earlier)
    if (sheetTexts.length === 0) {
      // try published CSV URL (original single-sheet pub link if present)
      try {
        const fallbackUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/pub?output=csv`;
        const r = await fetch(fallbackUrl);
        if (r.ok) {
          const t = await r.text();
          if (t && t.indexOf(",") !== -1) sheetTexts.push({ gid: 'pub', text: t });
        }
      } catch (e) {}
    }

    const sheetObjects = [];
    for (const s of sheetTexts) {
      const rows = parseCSV(s.text);
      // If first row is blank, drop it
      let headerRow = rows[0] || [];
      // Clean header: remove leading empty or numbers
      // Try to detect sheet name from the CSV text if available (Google sometimes includes title)
      let inferredName = `gid_${s.gid}`;

      // Heuristic: if first cell of first row looks like sheet title (non-empty and there is no comma in that row), use it.
      if (headerRow.length === 1 && headerRow[0] && headerRow[0].length > 2 && headerRow[0].indexOf(',') === -1) {
        inferredName = headerRow[0].slice(0,40);
        // promote next row to header if present
        if (rows[1]) {
          headerRow = rows[1];
          rows.splice(0,1); // remove first
        }
      }

      // If headerRow contains numbers only or empty, try to scan forward for row with alpha column names
      const alphaHeaderIdx = rows.findIndex(r => r.some(c => /[A-Za-z\u00C0-\u017F]/.test((c||'').toString())));
      if (alphaHeaderIdx > 0) {
        headerRow = rows[alphaHeaderIdx];
        // data rows after header
        rows.splice(0, alphaHeaderIdx+1);
      } else {
        // normal case: remove header row from rows for data rows
        rows.splice(0,1);
      }

      const headers = headerRow.map(h => h ? h.toString().trim() : '');
      // Decide whether candidate sheet
      const headersNorm = headers.map(normalizeHeader);
      const looksCandidate = sheetLooksLikeCandidate(headersNorm);

      let processed = null;
      if (looksCandidate) {
        processed = buildFromCandidateSheet(rows, headers);
      } else {
        // store as raw sheet rows
        processed = { students: [], summary: [], rawRows: rows, headers };
      }

      sheetObjects.push({
        gid: s.gid,
        name: inferredName,
        headers,
        processed,
        rawText: s.text
      });
    }

    // Combine students/summary from all candidate-like sheets
    const combinedStudents = [];
    const combinedSummary = [];
    sheetObjects.forEach(sh => {
      if (sh.processed.students && sh.processed.students.length) combinedStudents.push(...sh.processed.students);
      if (sh.processed.summary && sh.processed.summary.length) combinedSummary.push(...sh.processed.summary);
    });

    // if no combined summary, create placeholder using raw sheets list
    const sourceObj = {
      id: 1,
      name: "PPSA Multi-Sheet (Live)",
      previousGP: null,
      rawSheets: sheetObjects,
      students: combinedStudents,
      summary: combinedSummary.length ? combinedSummary : sheetObjects.flatMap(s=>s.processed.summary || [])
    };

    return sourceObj;
  }

  // =========== SIMPLE UI COMPONENTS (KPIs & Small Cards) ===========
  const KpiCard = ({ title, value, subtext }) => (
    <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
      <div className="flex justify-between items-start">
        <div>
          <p className="text-xs font-semibold uppercase text-gray-500">{title}</p>
          <h3 className="text-2xl font-bold text-gray-800 mt-1">{value}</h3>
        </div>
      </div>
      {subtext && <p className="text-xs text-gray-500 mt-2">{subtext}</p>}
    </div>
  );

  // Group card
  const GroupCard = ({ title, subtitle, count, total, color }) => (
    <div className={`p-4 rounded-xl border ${color || 'border-gray-100 bg-white'}`}>
      <p className="text-xs text-gray-500">{title}</p>
      <h3 className="text-xl font-bold mt-2">{count}</h3>
      {total != null && <p className="text-xs text-gray-400 mt-1">{((count/Math.max(total,1))*100).toFixed(1)}%</p>}
      <p className="text-xs text-gray-400 mt-2">{subtitle}</p>
    </div>
  );

  // ======= MAIN APP ========
  function App() {
    const [loading, setLoading] = useState(true);
    const [source, setSource] = useState(null);
    const [user, setUser] = useState(null);
    const [masterSwotData, setMasterSwotData] = useState({});
    const [masterInterventionData, setMasterInterventionData] = useState({});
    const [globalKpiTarget, setGlobalKpiTarget] = useState(4.5);

    // Load sheets once
    useEffect(() => {
      let cancelled = false;
      (async () => {
        setLoading(true);
        const src = await loadAllSheetsAsSource();
        if (!cancelled) {
          setSource(src);
        }
        setLoading(false);
      })();
      return () => cancelled = true;
    }, []);

    // Realtime DB listeners for shared data (swot & interventions)
    useEffect(() => {
      if (!window.db) return;
      const swotRef = window.db.ref('MASTER_SWOT_DATA');
      swotRef.on('value', snap => {
        const val = snap.val() || {};
        setMasterSwotData(val);
      });
      const interRef = window.db.ref('MASTER_INTERVENTION_DATA');
      interRef.on('value', snap => {
        const val = snap.val() || {};
        setMasterInterventionData(val);
      });

      const kpiRef = window.db.ref('globalKpiTarget');
      kpiRef.on('value', snap => {
        const v = snap.val();
        if (v !== null && v !== undefined) setGlobalKpiTarget(parseFloat(v));
      });

      return () => {
        swotRef.off();
        interRef.off();
        kpiRef.off();
      };
    }, []);

    // Simple auth: localStorage users (same pattern you had)
    useEffect(() => {
      const saved = localStorage.getItem('currentUser');
      if (saved) {
        try { setUser(JSON.parse(saved)); } catch(e){ localStorage.removeItem('currentUser'); }
      }
    }, []);

    const handleLoginMock = (userInfo) => {
      setUser(userInfo);
      localStorage.setItem('currentUser', JSON.stringify(userInfo));
    };
    const handleLogout = () => {
      setUser(null);
      localStorage.removeItem('currentUser');
    };

    // Save swot to DB (keyed by userId or by school)
    const saveSwotToDB = async (userId, schoolId, plan) => {
      try {
        const path = `MASTER_SWOT_DATA/${userId}/${schoolId}`;
        await window.db.ref(path).set(plan);
        // local update is handled by listener
      } catch (e) {
        console.error("Failed to save SWOT to DB", e);
      }
    };

    // Save intervention to DB
    const saveInterventionToDB = async (userId, schoolId, plan) => {
      try {
        const path = `MASTER_INTERVENTION_DATA/${userId}/${schoolId}`;
        await window.db.ref(path).set(plan);
      } catch (e) {
        console.error("Failed to save intervention", e);
      }
    };

    // UI: if not logged in show auth wrapper
    if (!user) {
      return <AuthWrapper onLogin={handleLoginMock} />;
    }

    if (loading || !source) {
      return (
        <div className="min-h-screen flex items-center justify-center">
          <div className="text-center">
            <div className="loader mb-4"></div>
            <p className="text-gray-600">Loading PPSA sheets and building dashboard... Please wait.</p>
          </div>
        </div>
      );
    }

    // Derived KPIs
    const totalCandidates = source.summary.reduce((acc, r) => acc + (r.totalCandidates||0), 0);
    const weightedSum = source.summary.reduce((acc, r) => acc + ((r.gp || 9) * (r.totalCandidates || 0)), 0);
    const gp = totalCandidates ? (weightedSum / totalCandidates).toFixed(2) : 'N/A';

    // grade groups totals
    const gradeCounts = grades.reduce((acc,g)=>{ acc[g]=0; return acc; }, {});
    source.summary.forEach(s => {
      Object.entries(s.grades || {}).forEach(([g,q]) => { gradeCounts[g] = (gradeCounts[g] || 0) + (q||0); });
    });
    const groups = {
      cemerlang: (gradeCounts['A+']||0) + (gradeCounts['A']||0) + (gradeCounts['A-']||0),
      kepujian: (gradeCounts['B+']||0)+(gradeCounts['B']||0)+(gradeCounts['C+']||0)+(gradeCounts['C']||0),
      lulus: (gradeCounts['D']||0)+(gradeCounts['E']||0),
      gagal: (gradeCounts['G']||0),
      th: (gradeCounts['TH']||0)
    };

    // Render main dashboard
    return (
      <div className="flex h-screen">
        <aside className="w-64 bg-slate-900 text-white p-6 flex flex-col">
          <h2 className="font-bold text-lg">R.E.A.D. Dashboard</h2>
          <p className="text-xs text-slate-300 mt-1">PPSA multi-sheet import</p>
          <div className="mt-4">
            <p className="text-xs text-slate-400">Signed in as</p>
            <p className="font-semibold mt-1">{user.name} <span className="text-xs text-slate-300">({user.role || 'viewer'})</span></p>
          </div>
          <div className="mt-auto">
            <button onClick={handleLogout} className="w-full bg-red-600 py-2 rounded-md">Sign out</button>
          </div>
        </aside>

        <main className="flex-1 p-8 overflow-auto">
          <header className="flex justify-between items-start mb-6">
            <div>
              <h1 className="text-2xl font-bold">Data Overview</h1>
              <p className="text-sm text-gray-600">Active Source: <span className="font-semibold">{source.name}</span></p>
            </div>
            <div className="flex gap-4">
              <KpiCard title="Grade Purata (GP)" value={gp} subtext={`Total candidates: ${totalCandidates}`} />
            </div>
          </header>

          <section className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <GroupCard title="Cemerlang (A+/A/A-)" subtitle="Top band" count={groups.cemerlang} total={totalCandidates} color="border-emerald-200 bg-emerald-50" />
            <GroupCard title="Kepujian (B+/B/C+/C)" subtitle="Credit band" count={groups.kepujian} total={totalCandidates} color="border-blue-200 bg-blue-50" />
            <GroupCard title="Lulus (D/E)" subtitle="Pass band" count={groups.lulus} total={totalCandidates} color="border-yellow-200 bg-yellow-50" />
          </section>

          <section className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div className="bg-white p-6 rounded-xl shadow-sm">
              <h3 className="font-semibold mb-4">Grade Group Distribution</h3>
              <div style={{ height: 260 }}>
                <ResponsiveContainer width="100%" height="100%">
                  <PieChart>
                    <Pie data={[
                      { name: 'Cemerlang', value: groups.cemerlang },
                      { name: 'Kepujian', value: groups.kepujian },
                      { name: 'Lulus', value: groups.lulus },
                      { name: 'Gagal', value: groups.gagal }
                    ]} dataKey="value" nameKey="name" cx="50%" cy="50%" outerRadius={80} label>
                      <Cell fill="#10B981" />
                      <Cell fill="#3B82F6" />
                      <Cell fill="#F59E0B" />
                      <Cell fill="#EF4444" />
                    </Pie>
                    <Tooltip />
                    <Legend />
                  </PieChart>
                </ResponsiveContainer>
              </div>
            </div>

            <div className="bg-white p-6 rounded-xl shadow-sm">
              <h3 className="font-semibold mb-4">Sheets imported</h3>
              <ul className="space-y-2 text-sm">
                {source.rawSheets.map(s => (
                  <li key={s.gid} className="p-2 rounded border border-gray-100">
                    <div className="flex justify-between">
                      <div>
                        <div className="font-semibold">{s.name || `Sheet gid ${s.gid}`}</div>
                        <div className="text-xs text-gray-500">gid: {s.gid} — headers: {s.headers.map((h,i)=>h?h:'-').slice(0,6).join(', ')}</div>
                      </div>
                      <div className="text-xs text-gray-400">{s.processed && s.processed.students && s.processed.students.length ? `${s.processed.students.length} students` : (s.processed.rawRows ? `${s.processed.rawRows.length} rows` : '')}</div>
                    </div>
                  </li>
                ))}
              </ul>
            </div>
          </section>

          <section className="bg-white p-6 rounded-xl shadow-sm">
            <h3 className="font-semibold mb-3">School GP Comparison (Aggregate)</h3>
            <div className="overflow-x-auto">
              <table className="min-w-full text-sm">
                <thead className="text-xs text-gray-500">
                  <tr>
                    <th className="px-3 py-2 text-left">School</th>
                    <th className="px-3 py-2 text-right">GP</th>
                    <th className="px-3 py-2 text-right">Total Candidates</th>
                  </tr>
                </thead>
                <tbody>
                  {source.summary.sort((a,b)=> (a.gp||9) - (b.gp||9)).map((r, idx) => (
                    <tr key={idx} className="border-t">
                      <td className="px-3 py-2">{r.schoolName}</td>
                      <td className="px-3 py-2 text-right">{r.gp}</td>
                      <td className="px-3 py-2 text-right">{r.totalCandidates}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </section>

        </main>
      </div>
    );
  }

  // ======= AUTH WRAPPER (simple register/login for demo) =======
  function AuthWrapper({ onLogin }) {
    const [mode, setMode] = useState('login');
    const [name, setName] = useState('');
    const [username, setUsername] = useState('');
    const [password, setPassword] = useState('');
    const handleRegister = (e) => {
      e.preventDefault();
      const users = JSON.parse(localStorage.getItem('MOCK_USERS') || '[]');
      const newUser = { id: users.length ? Math.max(...users.map(u=>u.id))+1:1, name: name || username || 'User', username, password, role: users.length ? 'viewer' : 'admin' };
      users.push(newUser);
      localStorage.setItem('MOCK_USERS', JSON.stringify(users));
      onLogin(newUser);
    };
    const handleLogin = (e) => {
      e.preventDefault();
      const users = JSON.parse(localStorage.getItem('MOCK_USERS') || '[]');
      const user = users.find(u => u.username === username && u.password === password);
      if (user) onLogin(user);
      else alert('Invalid credentials. If first time, register instead.');
    };

    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-100 p-6">
        <div className="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
          <h2 className="text-xl font-bold mb-4">R.E.A.D. Dashboard</h2>
          {mode==='login' ? (
            <form onSubmit={handleLogin} className="space-y-3">
              <div>
                <label className="text-sm">Username</label>
                <input className="w-full border p-2 rounded mt-1" value={username} onChange={e=>setUsername(e.target.value)} />
              </div>
              <div>
                <label className="text-sm">Password</label>
                <input type="password" className="w-full border p-2 rounded mt-1" value={password} onChange={e=>setPassword(e.target.value)} />
              </div>
              <button type="submit" className="w-full bg-blue-600 text-white py-2 rounded">Sign In</button>
              <div className="text-center mt-2 text-xs">
                <button type="button" onClick={()=>setMode('register')} className="text-green-600">Register account</button>
              </div>
            </form>
          ) : (
            <form onSubmit={handleRegister} className="space-y-3">
              <div>
                <label className="text-sm">Full name</label>
                <input className="w-full border p-2 rounded mt-1" value={name} onChange={e=>setName(e.target.value)} />
              </div>
              <div>
                <label className="text-sm">Username</label>
                <input className="w-full border p-2 rounded mt-1" value={username} onChange={e=>setUsername(e.target.value)} />
              </div>
              <div>
                <label className="text-sm">Password</label>
                <input type="password" className="w-full border p-2 rounded mt-1" value={password} onChange={e=>setPassword(e.target.value)} />
              </div>
              <button type="submit" className="w-full bg-green-600 text-white py-2 rounded">Register & Sign In</button>
              <div className="text-center mt-2 text-xs">
                <button type="button" onClick={()=>setMode('login')} className="text-blue-600">Already have an account? Sign in</button>
              </div>
            </form>
          )}
        </div>
      </div>
    );
  }

  // ==== Render App ====
  ReactDOM.createRoot(document.getElementById('root')).render(<App />);

  </script>
</body>
</html>
